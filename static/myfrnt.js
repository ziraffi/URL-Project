var urlFlag=!1,fileSectionLoaded=!1,sheetNamesFetched=!1;$(document).ready(function(){var e=0,t=$("footer");$(window).scroll(function(){var a=$(this).scrollTop(),n=$(document).scrollTop();a>e?n+$(window).height()<=$(document).height()&&t.stop(!0,!0).fadeIn(600):t.stop(!0,!0).animate({opacity:0,bottom:"-100px"},{duration:600,complete:function(){$(this).css("display","none").css("bottom","0").css("opacity",1)}}),e=a})}),$(document).ready(function(){var e=$(".page-header"),t="is-sticky",a=$(".strtHeader"),n=$(window).height();$("footer"),$("#toggleButton").click(function(){$("#url-container").toggle()}),$(window).scroll(function(){var o=$(this).scrollTop();o>.6*n||0<o?(e.addClass(t).show(),urlFlag?$("#floatContainer").show().animate({left:"50px"},1500):$("#floatContainer").hide()):(e.removeClass(t).fadeOut(),a.fadeIn(),$("#floatContainer").stop().animate({left:"-50px"},1500),e.hide())}),$("#toggle_file").on("click",function(){$("#manual_form").removeClass("right-side").hide(),$("#file_form").show().addClass("left-side"),$("#manual_form").hide(),$("#url-container").hide(),$("#manual-data").val(""),$("#manual-data-table").empty(),$("#mnl-tbl").hide(),urlFlag=!1,x({},v=!0),$("#tableDiv").hide(),$("#tbl-section").hide(),$("#downloadButtonContainer").hide(),$("#totalProcessingTime").hide()}),$("#toggle_manual").on("click",function(){$("#file_form").removeClass("left-side").hide(),$("#manual_form").show().addClass("right-side"),$("#url-container").hide(),$("#file").val(""),$("#sheet-name").empty(),$("#column-name").empty(),$("#file-data-table").empty(),$("#file-tbl").hide(),urlFlag=!1,x({},v=!0),$("#tableDiv").hide(),$("#tbl-section").hide(),$("#downloadButtonContainer").hide(),$("#totalProcessingTime").hide()});let o=$(".bi-layout-sidebar-inset"),i=$(".close-icon"),l=$(".navigation");async function s(e){if(console.log("Loading form section:",e),"file_section"!==e||!fileSectionLoaded)try{let t=await fetch("/templates/"+e+".html");if(!t.ok)throw Error("Failed to load form section");let a=await t.text();$("#form-container").html(a).show(),console.log("Form section loaded:",e),"file_section"===e&&(fileSectionLoaded=!0)}catch(n){console.error("Error loading form section:",n),$("#form-container").html("<p>Error loading form.</p>")}}o.on("click",function(){l.addClass("active"),o.hide(),i.show()}),i.on("click",function(){l.removeClass("active"),o.show(),i.hide()});var r=["file_section","batch_section","dropdown_section","output_file_selection"],c=0;async function d(e){e.preventDefault();let t=$("#manual-data").val(),a=$("#sheet-name").val(),n=$("#column-name").val();try{let o=await fetch("/process_manual_input",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({manual_data:t,selected_sheet:a,selected_column:n})});if(!o.ok)throw Error("Failed to submit manual data");let i=await o.json();$("#valid_list").empty(),$("#invalid_list").empty(),i.error_message?$("#error-message").text(i.error_message):($("#valid_list").empty(),$("#invalid_list").empty(),function e(t){let a=!1,n=!1;$("#valid_list").empty(),$("#invalid_list").empty();let o=[],i=[],l=[],s=[];for(let r=0;r<t.length;r++){let c=t[r].data,d=t[r].column_number,p=t[r].row_number,m=t[r].sheet_number;h(c)?(o.push(c),i.push(d),l.push(p),s.push(m),a=!0,$("#valid_list").append($('<a class="hover-underline-animation linkText"></a>').attr("href",c).text(c)),$("#valid_list").append("<br>")):""!==c.trim()&&(n=!0,$("#invalid_list").append($("<p></p>").text(c)))}let f={data:o,column_number:i,row_number:l,sheet_number:s,choosen:["Entered Data Manually"]};a?(console.log("manualDataSet:",f),$("#valid_list").prepend($("<h3>Fetched URLs:</h3>")),$("#valid_list").show()):$("#valid_list").hide(),n?($("#invalid_list").prepend($("<h3>Junk:</h3>")),$("#invalid_list").show()):$("#invalid_list").hide(),urlFlag=!!a||!!n,f&&f.data&&0!==f.data.length?u(null,f):($("#manual-data-table").empty(),$("#mnl-tbl").hide())}(i.column_data))}catch(l){console.error("Error:",l)}}function h(e){return RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e)}async function p(e){let t={data:[],column_number:[],row_number:[],sheet_number:[],choosen:[]};try{let a=await fetch("/input_section",{method:"POST",body:e});if(!a.ok)throw Error("Failed to fetch column Data");let n=await a.json();$("#valid_list").empty(),$("#invalid_list").empty();var o=n.column_data;let i=n.selected_file;if(o&&o.length>0){let l=!1,s=!1;0===t.choosen.length&&t.choosen.push(i),o.forEach(e=>{let a=e.data,n=e.column_number,o=e.row_number,i=e.sheet_number;if(h(a))t.column_number.push(n),t.row_number.push(o),t.sheet_number.push(i),t.data.push(a),$("#valid_list").append($('<a class="hover-underline-animation linkText"></a>').attr("href",a).text(a)),$("#valid_list").append("<br>"),l=!0;else{if(null===a)return;$("#invalid_list").append($("<p></p>").text(a)),s=!0}}),l?($("#valid_list").prepend($("<h3>Fetched URLs</h3>")),$("#valid_list").show(),console.log("dataSet:",t)):$("#valid_list").hide(),s?($("#invalid_list").prepend($("<h3>Junk:</h3>")),$("#invalid_list").show()):$("#invalid_list").hide(),urlFlag=!!l||!!s}else $("#invalid_list").append($("<p>No URLs found for the selected column.</p>")),$("#invalid_list").show(),$("#valid_list").hide()}catch(r){console.error("Error fetching column Data:",r)}t&&t.data&&0!==t.data.length?u(t,null):($("#file-data-table").empty(),$("#file-tbl").hide())}function u(e,t){$("#manual-data-table").empty(),$("#file-tbl").hide(),$("#mnl-tbl").hide(),e&&(m(e,"#file-data-table"),$("#file-tbl").show(),$("#manual-data-table").hide(),$("#file-data-table").show()),t&&(m(t,"#manual-data-table"),$("#mnl-tbl").show(),$("#file-data-table").hide(),$("#manual-data-table").show()),$("#tbl-section").show()}function m(e,t){if(!e||!e.data||0===e.data.length){$(t).empty();return}let a=$("<div>"),n=$("<caption>").text(e.choosen[0]),o=$('<div class="firstCap"><p>Source Of Data: <span class="source">'+n.text()+"</span></p></div>");a.append(o);let i=$("<table>").addClass("data-table"),l=Object.keys(e),s=$("<tr>");s.append(function e(){let t=$("<th>"),a=$("<select>").append($("<option>").text("select"),$("<option>").text("First 5").attr("value","Option 1"),$("<option>").text("First 10").attr("value","Option 2"),$("<option>").text("First 50").attr("value","Option 3"),$("<option>").text("First 100").attr("value","Option 4"),$("<option>").text("First 300").attr("value","Option 5"),$("<option>").text("More").attr("value","Choose").prop("disabled",!0));return t.append(a),t}()),["Valid URLs","Column No.","Row No.","Sheet No."].forEach(e=>{s.append($("<th>").text(e))}),i.append(s);for(let r=0;r<e.data.length;r++){let c=$("<tr>");if(r>=0){let d=$("<td>").append($("<input>").attr("type","checkbox").addClass("row-checkbox"));c.append(d)}l.forEach(t=>{if("choosen"!==t){let a=e[t][r];c.append($("<td>").text(a))}}),i.append(c)}a.append(i),$(t).empty().append(a)}function f(e){var t,a;$("input:checkbox.row-checkbox").prop("disabled",!1),"select"===e&&$("input:checkbox.row-checkbox").prop("checked",!1),"Option 1"===e?b(5):"Option 2"===e?b(10):"Option 3"===e?b(50):"Option 4"===e?b(100):"Option 5"===e&&b(300),g(),t={url_list:[],column_number:[],row_number:[],sheet_number:[],choosen:[]},a=$("caption").text(),$("input:checkbox.row-checkbox:checked").each(function(){var e=$(this).closest("tr");t.url_list.push(e.find("td:nth-child(2)").text()),t.column_number.push(e.find("td:nth-child(3)").text()),t.row_number.push(e.find("td:nth-child(4)").text()),t.sheet_number.push(e.find("td:nth-child(5)").text())}),t.choosen.push(a),$("#send_serve").off("click").on("click",async function(){$("#processedTable").hide(),$("#tableDiv").hide(),$("#totalProcessingTime").empty().hide(),await x(t,v=!1)})}function b(e){var t=$("input:checkbox.row-checkbox");t.prop("checked",!1),t.slice(0,e).prop("checked",!0),t.length>e&&t.slice(e).prop("disabled",!0)}function g(){var e=$("input:checkbox.row-checkbox").length,t=$("input:checkbox.row-checkbox:checked").length;$("#check_all").prop("checked",e===t)}s(r[c]),$(document).on("click","#load-next-section-button",function(){console.log("Button clicked"),++c<r.length?s(r[c]):console.log("All form sections loaded.")}),$(document).on("click","#manual-form-submit",d),$(document).on("change","select",function(){var e=$(this).val();f(e)}),$(document).on("click","#check_all",function(){$(this).prop("checked")?$("input:checkbox.row-checkbox").prop("checked",!0):$("input:checkbox.row-checkbox").prop("checked",!1)}),$(document).on("change","input:checkbox.row-checkbox",function(){var e=$("select").val(),t=$("input:checkbox.row-checkbox:checked").length;if(y(),t>300&&$(this).is(":checked")){$(this).prop("checked",!1),alert("Maximum 300 items can be selected.");return}g(),f(e)}),$("input:checkbox.row-checkbox").on("change",function(){g(),f($("select").val())});var v=!1;function y(){let e=$("input:checkbox.row-checkbox:checked").length>0;e?$("#send_serve").show():$("#send_serve").hide()}$(document).on("change","select",function(){y()}),$(document).on("change","input:checkbox.row-checkbox",function(){y()}),y(),$("#cancelButton").off("click").on("click",async function(){await x({},v=!0)});var w=!1;async function k(){if($("#loadingIndicator").show(),$("#progressPercentage").show(),$("#tableDiv").show(),!0===w){console.log("Processing canceled.");try{await fetch("/progress",{async:"true",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cancelFlag:w})})}catch(e){console.error("Error sending cancel flag to progress endpoint:",e)}return}try{let t=await fetch("/progress",{async:"true",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cancelFlag:w})});var{pInfo_obj:a,tryPercent:n}=await t.json();await C(n.toFixed(2)),await _(a)}catch(o){console.error("Error fetching progress:",o)}}async function x(e,t){if(!0===(w=t)){console.log("Processing canceled at SendtoServer");return}try{$("#downloadButtonContainer").hide();let a=new Date().getTime();if(!e||!e.url_list||0===e.url_list.length)throw Error("Error: DataSet is undefined or empty");$("#cancelButton").show();var n=setInterval(k,2e3);console.log("Sending data to server:",e),console.log("Stringified Data:",JSON.stringify(e));var o=await fetch("/process_url_data",{method:"POST",async:"true",headers:{"Content-Type":"application/json"},body:JSON.stringify({clientUrlSet:e,cancelFlag:w})});let i=await o.json(),l=new Date().getTime(),s=function e(t){let a;if(t<60)a=t+" seconds";else if(t<3600){let n=(t%60).toFixed(2);a=Math.floor(t/60)+" minutes "+n+" seconds"}else a=Math.floor(t/3600)+" hours "+Math.floor(t%3600/60)+" minutes "+seconds+" seconds";return a}(Math.floor((l-a)/1e3));if($("#totalProcessingTime").empty().append("<p>Total Processing Time: "+s+" </p>"),$("#totalProcessingTime").show(),i.error)throw Error("Error from server: "+i.error);if($("#processedTable").show(),i.has_downloadable_data?(T(i.csv_filename),console.log("response.csv_filename: ",i.csv_filename),$("#downloadButtonContainer").show()):$("#downloadButtonContainer").hide(),await k(t),!i||!i.pInfo_obj)return}catch(r){console.error("Error sending data to server:",r)}finally{clearInterval(n),$("#loadingIndicator").hide()}}async function T(e){$("#downloadButton").on("click",async function(){try{let t=new FormData;t.append("filename",e);let a=await fetch(`/download/${e}`,{method:"POST",body:t});if(!a.ok)throw Error("Failed to download CSV file");let n=await a.blob(),o=document.createElement("a");o.href=window.URL.createObjectURL(n),o.download=e,o.click(),window.URL.revokeObjectURL(o.href),o.remove(),console.log("CSV file download successful.")}catch(i){console.error("Error downloading CSV:",i),alert("Error downloading CSV: Please try again.")}})}async function C(e){try{if(void 0!==e){let t=parseInt(e);$("#progressPercentage span").text(t+"%"),$("#progressBlock").css("--value",t),console.log("Progress percentage updated:",t+"%")}else{console.error("Progress percentage is undefined");return}}catch(a){console.error("Error updating progress percentage:",a)}}async function _(e){if($("#tryTable").empty(),$("#tableDiv").show(),!e||0===e.length)return;var t='<table id="innerTrytable" class="data-table" border="1">';t+="<thead><tr>";let a=["Sr.No","URL","Domain Status","Expiration Date","For Sale","Response Message","Response Time","Status Code"];a.forEach(e=>{"Sr.No"===e?t+=`<th class="sortable" data-key="${e}">${e} <i class="bi bi-sort-numeric-down"></i></th>`:"Expiration Date"===e?t+=`<th class="sortable" data-key="${e}">${e} <i class="bi bi-sort-numeric-down"></i></th>`:"Response Time"===e?t+=`<th class="sortable" data-key="${e}">${e} <i class="bi bi-sort-numeric-down-alt"></i></th>`:t+=`<th class="sortable" data-key="${e}">${e}</th>`}),t+="</tr></thead><tbody>",e.forEach((e,n)=>{let o="<tr>";a.forEach(t=>{"Expiration Date"===t&&(o+=`<td>${new Date(e[t]).toLocaleString()}</td>`),"Sr.No"===t?o+=`<td>${n+1}</td>`:"Expiration Date"!==t&&(o+=`<td>${e[t]}</td>`)}),o+="</tr>",t+=o}),t+="</tbody></table>",$("#tryTable").append(t),$(".sortable").on("click",function(){let e=$(this).data("key");(function e(t,a){let n=$("#innerTrytable"),o=n.find("tbody > tr").toArray(),i=$(this).hasClass("desc");"Expiration Date"===t||"Response Time"===t?o.sort((e,n)=>{let o=$(e).find(`td:eq(${a.indexOf(t)})`).text(),l=$(n).find(`td:eq(${a.indexOf(t)})`).text();return o=String(o),l=String(l),i?o.localeCompare(l):l.localeCompare(o)}):"Sr.No"===t&&o.sort((e,n)=>{let o=parseInt($(e).find(`td:eq(${a.indexOf(t)})`).text()),l=parseInt($(n).find(`td:eq(${a.indexOf(t)})`).text());return i?l-o:o-l}),n.find("tbody").html(o),$(this).toggleClass("desc")})(e,a)})}let S;function F(e){try{fetch("/input_section",{method:"POST",body:e}).then(e=>{if(!e.ok)throw Error("Failed to fetch sheet names and column names");return e.json()}).then(e=>{S=e.selected_sheet,e.is_csv?(O(e.sheet_columns,S,e.column_data),$("#sheet-name").empty().hide(),$('label[for="sheet-name"]').hide()):(E(S,e.sheet_names),O(e.sheet_columns[S],S,e.column_data),$("#sheet-name").val(S),$("#sheet-name").show(),$('label[for="sheet-name"]').show());var t=$("#column-name").val();if(t){var a=new FormData;a.append("file",$("#file")[0].files[0]),a.append("selected_sheet",S),a.append("selected_column",t),p(a)}}).catch(e=>{console.error("Error fetching sheet names and column names:",e)})}catch(t){console.error("Error fetching sheet names and column names:",t)}}async function E(e,t){var a=$("#sheet-name");a.empty(),t&&t.length>0?($.each(t,function(e,t){a.append($("<option></option>").val(t).text(t))}),e||(e=t[0])):(console.error("No sheet names available."),a.append($("<option disabled selected>Please choose a sheet</option>")))}async function O(e,t){var a=$("#column-name");a.empty(),e?$.each(e,function(e,t){a.append($("<option></option>").val(t).text(t))}):(console.error("No column names available for the selected sheet:",t),a.append($("<option disabled selected>No columns available</option>")));var n=a.val(),o=new FormData;n&&(o.append("file",$("#file")[0].files[0]),o.append("selected_sheet",t),o.append("selected_column",n),p(o))}$(document).on("change","#column-name",function(){var e=$(this).val(),t=new FormData;e?(S=$("#sheet-name").val(),t.append("file",$("#file")[0].files[0]),t.append("selected_sheet",S),t.append("selected_column",e),p(t),$("#totalProcessingTime").empty().hide(),$("#processedTable").hide(),$("#tableDiv").hide(),$("#downloadButtonContainer").hide(),urlFlag=!1):console.log("No valid column selected.")}),$(document).on("change","#sheet-name",function(){S=$(this).val();var e=new FormData;e.append("file",$("#file")[0].files[0]),e.append("selected_sheet",S),F(e),$("totalProcessingTime").empty().hide(),$("#processedTable").hide(),$("#tableDiv").hide(),$("#downloadButtonContainer").hide(),urlFlag=!1}),$(document).on("change","#file",function(){$("#valid_list").empty();var e=$(this)[0].files[0];if(e&&e.size>1048576)return $("#tbl-section").hide(),$("#sheet-name").empty(),$("#column-name").empty(),$("#toggleButton").hide(),alert("File size exceeds 1 MB. Please choose a smaller file."),!1;var t=new FormData;$("#processedTable").hide(),$("#tableDiv").hide(),$("caption").empty().hide(),$("#totalProcessingTime").empty().hide(),$("#downloadButtonContainer").hide(),$("#url-container").hide(),urlFlag=!1,e?(t.append("file",e),F(t)):(console.error("No file selected."),$("#tbl-section").hide(),$("#sheet-name").empty(),$("#column-name").empty())})}),$(".developer").hover(function(){$(".tooltip").css("visibility","visible").css("opacity","1")},function(){$(".tooltip").css("visibility","hidden").css("opacity","0")}),$(document).ready(function(){$(window).scroll(function(){$(".content").each(function(){var e=$(this).offset().top,t=$(window).scrollTop(),a=$(window).height();e<t+a-50&&$(this).addClass("animate2top")}),$(".contentBtm").each(function(){var e=$(this).offset().top,t=$(window).scrollTop(),a=$(window).height();e<t+a-100&&$(this).addClass("animate2Btm")}),$(".contentR").each(function(){var e=$(this).offset().top,t=$(window).scrollTop(),a=$(window).height();e<t+a-50&&$(this).addClass("animate2right")}),$(".contentL").each(function(){var e=$(this).offset().top,t=$(window).scrollTop(),a=$(window).height();e<t+a-50&&$(this).addClass("animate2Left")})})});