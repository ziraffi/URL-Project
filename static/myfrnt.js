var urlFlag=!1,fileSectionLoaded=!1,sheetNamesFetched=!1;function setCookie(e,t,n){var o="";if(n){var a=new Date;a.setTime(a.getTime()+864e5*n),o="; expires="+a.toUTCString()}document.cookie=e+"="+(t||"")+o+"; path=/"}function getCookie(e){for(var t=e+"=",n=document.cookie.split(";"),o=0;o<n.length;o++){for(var a=n[o];" "==a.charAt(0);)a=a.substring(1,a.length);if(0==a.indexOf(t))return a.substring(t.length,a.length)}return null}$(document).ready(function(){var e=$(window).height(),t=$("footer"),n=$("header"),o=0;$("#toggleButton").click(function(){$("#url-container").toggle()}),$(window).scroll(function(){var a=$(this).scrollTop();a>.6*e||o<a?(n.stop().animate({top:"-100px",opacity:0},200),urlFlag?$("#floatContainer").show().animate({left:"50px"},1500):$("#floatContainer").hide()):($("#floatContainer").stop().animate({left:"-50px"},1500),n.animate({top:"0",opacity:1},0)),$(window).scrollTop()>o?a+$(window).height()<=$(document).height()&&t.fadeIn():t.fadeOut(),o=a}),$("#toggle_file").on("click",function(){$("#manual_form").removeClass("right-side").hide(),$("#file_form").show().addClass("left-side"),$("#manual_form").hide(),$("#url-container").hide(),$("#manual-data").val(""),$("#manual-data-table").empty(),$("#mnl-tbl").hide(),urlFlag=!1,x({},g=!0),$("#tableDiv").hide(),$("#tbl-section").hide(),$("#downloadButtonContainer").hide(),$("#totalProcessingTime").hide()}),$("#toggle_manual").on("click",function(){$("#file_form").removeClass("left-side").hide(),$("#manual_form").show().addClass("right-side"),$("#url-container").hide(),$("#file").val(""),$("#sheet-name").empty(),$("#column-name").empty(),$("#file-data-table").empty(),$("#file-tbl").hide(),urlFlag=!1,x({},g=!0),$("#tableDiv").hide(),$("#tbl-section").hide(),$("#downloadButtonContainer").hide(),$("#totalProcessingTime").hide()});let a=$(".bi-layout-sidebar-inset"),i=$(".close-icon"),l=$(".navigation");async function s(e){if("file_section"!==e||!fileSectionLoaded)try{let t=await fetch("/templates/"+e+".html");if(!t.ok)throw Error("Failed to load form section");let n=await t.text();$("#form-container").html(n).show(),"file_section"===e&&(fileSectionLoaded=!0)}catch(o){console.error("Error loading form section:",o),$("#form-container").html("<p>Error loading form.</p>")}}a.on("click",function(){l.addClass("active"),a.hide(),i.show()}),i.on("click",function(){l.removeClass("active"),a.show(),i.hide()});var r=["file_section","batch_section","dropdown_section","output_file_selection"],c=0;async function d(e){e.preventDefault();let t=$("#manual-data").val(),n=$("#sheet-name").val(),o=$("#column-name").val();try{let a=await fetch("/process_manual_input",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({manual_data:t,selected_sheet:n,selected_column:o})});if(!a.ok)throw Error("Failed to submit manual data");let i=await a.json();$("#valid_list").empty(),$("#invalid_list").empty(),i.error_message?$("#error-message").text(i.error_message):($("#valid_list").empty(),$("#invalid_list").empty(),function e(t){let n=!1,o=!1;$("#valid_list").empty(),$("#invalid_list").empty();let a=[],i=[],l=[],s=[];for(let r=0;r<t.length;r++){let c=t[r].data,d=t[r].column_number,p=t[r].row_number,f=t[r].sheet_number;h(c)?(a.push(c),i.push(d),l.push(p),s.push(f),n=!0,$("#valid_list").append($('<a class="hover-underline-animation linkText"></a>').attr("href",c).text(c)),$("#valid_list").append("<br>")):""!==c.trim()&&(o=!0,$("#invalid_list").append($("<p></p>").text(c)))}let m={data:a,column_number:i,row_number:l,sheet_number:s,choosen:["Entered Data Manually"]};n?($("#valid_list").prepend($("<h3>Fetched URLs:</h3>")),$("#valid_list").show()):$("#valid_list").hide(),o?($("#invalid_list").prepend($("<h3>Junk:</h3>")),$("#invalid_list").show()):$("#invalid_list").hide(),urlFlag=!!n||!!o,m&&m.data&&0!==m.data.length?u(null,m):($("#manual-data-table").empty(),$("#mnl-tbl").hide())}(i.column_data))}catch(l){console.error("Error:",l)}}function h(e){return RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e)}async function p(e){let t={data:[],column_number:[],row_number:[],sheet_number:[],choosen:[]};try{let n=await fetch("/input_section",{method:"POST",body:e});if(!n.ok)throw Error("Failed to fetch column Data");let o=await n.json();$("#valid_list").empty(),$("#invalid_list").empty();var a=o.column_data;let i=o.selected_file;if(a&&a.length>0){let l=!1,s=!1;0===t.choosen.length&&t.choosen.push(i),a.forEach(e=>{let n=e.data,o=e.column_number,a=e.row_number,i=e.sheet_number;if(h(n))t.column_number.push(o),t.row_number.push(a),t.sheet_number.push(i),t.data.push(n),$("#valid_list").append($('<a class="hover-underline-animation linkText"></a>').attr("href",n).text(n)),$("#valid_list").append("<br>"),l=!0;else{if(null===n)return;$("#invalid_list").append($("<p></p>").text(n)),s=!0}}),l?($("#valid_list").prepend($("<h3>Fetched URLs</h3>")),$("#valid_list").show()):$("#valid_list").hide(),s?($("#invalid_list").prepend($("<h3>Junk:</h3>")),$("#invalid_list").show()):$("#invalid_list").hide(),urlFlag=!!l||!!s}else $("#invalid_list").append($("<p>No URLs found for the selected column.</p>")),$("#invalid_list").show(),$("#valid_list").hide()}catch(r){console.error("Error fetching column Data:",r)}t&&t.data&&0!==t.data.length?u(t,null):($("#file-data-table").empty(),$("#file-tbl").hide())}function u(e,t){$("#manual-data-table").empty(),$("#file-tbl").hide(),$("#mnl-tbl").hide(),e&&(f(e,"#file-data-table"),$("#file-tbl").show(),$("#manual-data-table").hide(),$("#file-data-table").show()),t&&(f(t,"#manual-data-table"),$("#mnl-tbl").show(),$("#file-data-table").hide(),$("#manual-data-table").show()),$("#tbl-section").show()}function f(e,t){if(!e||!e.data||0===e.data.length){$(t).empty();return}let n=$("<div>"),o=$("<caption>").text(e.choosen[0]),a=$('<div class="firstCap"><p>Source Of Data: <span class="source">'+o.text()+"</span></p></div>");n.append(a);let i=$("<table>").addClass("data-table"),l=Object.keys(e),s=$("<tr>");s.append(function e(){let t=$("<th>"),n=$("<select>").append($("<option>").text("select"),$("<option>").text("First 5").attr("value","Option 1"),$("<option>").text("First 10").attr("value","Option 2"),$("<option>").text("First 50").attr("value","Option 3"),$("<option>").text("First 100").attr("value","Option 4"),$("<option>").text("First 300").attr("value","Option 5"),$("<option>").text("More").attr("value","Choose").prop("disabled",!0));return t.append(n),t}()),["Valid URLs","Column No.","Row No.","Sheet No."].forEach(e=>{s.append($("<th>").text(e))}),i.append(s);for(let r=0;r<e.data.length;r++){let c=$("<tr>");if(r>=0){let d=$("<td>").append($("<input>").attr("type","checkbox").addClass("row-checkbox"));c.append(d)}l.forEach(t=>{if("choosen"!==t){let n=e[t][r];c.append($("<td>").text(n))}}),i.append(c)}n.append(i),$(t).empty().append(n)}function m(e){var t,n;$("input:checkbox.row-checkbox").prop("disabled",!1),"select"===e&&$("input:checkbox.row-checkbox").prop("checked",!1),"Option 1"===e?b(5):"Option 2"===e?b(10):"Option 3"===e?b(50):"Option 4"===e?b(100):"Option 5"===e&&b(300),v(),t={url_list:[],column_number:[],row_number:[],sheet_number:[],choosen:[]},n=$("caption").text(),$("input:checkbox.row-checkbox:checked").each(function(){var e=$(this).closest("tr");t.url_list.push(e.find("td:nth-child(2)").text()),t.column_number.push(e.find("td:nth-child(3)").text()),t.row_number.push(e.find("td:nth-child(4)").text()),t.sheet_number.push(e.find("td:nth-child(5)").text())}),t.choosen.push(n),$("#send_serve").off("click").on("click",async function(){$("#processedTable").hide(),$("#tableDiv").hide(),$("#totalProcessingTime").empty().hide(),await x(t,g=!1)})}function b(e){var t=$("input:checkbox.row-checkbox");t.prop("checked",!1),t.slice(0,e).prop("checked",!0),t.length>e&&t.slice(e).prop("disabled",!0)}function v(){var e=$("input:checkbox.row-checkbox").length,t=$("input:checkbox.row-checkbox:checked").length;$("#check_all").prop("checked",e===t)}s(r[c]),$(document).on("click","#load-next-section-button",function(){console.log("Button clicked"),++c<r.length?s(r[c]):console.log("All form sections loaded.")}),$(document).on("click","#manual-form-submit",d),$(document).on("change","select",function(){var e=$(this).val();m(e)}),$(document).on("click","#check_all",function(){$(this).prop("checked")?$("input:checkbox.row-checkbox").prop("checked",!0):$("input:checkbox.row-checkbox").prop("checked",!1)}),$(document).on("change","input:checkbox.row-checkbox",function(){var e=$("select").val(),t=$("input:checkbox.row-checkbox:checked").length;if(w(),t>300&&$(this).is(":checked")){$(this).prop("checked",!1),alert("Maximum 300 items can be selected.");return}v(),m(e)}),$("input:checkbox.row-checkbox").on("change",function(){v(),m($("select").val())});var g=!1;function w(){let e=$("input:checkbox.row-checkbox:checked").length>0;e?$("#send_serve").show():$("#send_serve").hide()}$(document).on("change","select",function(){w()}),$(document).on("change","input:checkbox.row-checkbox",function(){w()}),w(),$("#cancelButton").off("click").on("click",async function(){await x({},g=!0)});var y=!1;async function k(){if($("#loadingIndicator").show(),$("#progressPercentage").show(),$("#tableDiv").show(),!0===y){try{await fetch("/progress",{async:"true",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cancelFlag:y})})}catch(e){console.error("Error sending cancel flag to progress endpoint:",e)}return}try{let t=await fetch("/progress",{async:"true",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cancelFlag:y})});var{pInfo_obj:n,tryPercent:o}=await t.json();await C(o.toFixed(2)),await _(n)}catch(a){console.error("Error fetching progress:",a)}}async function x(e,t){if(!0!==(y=t))try{$("#downloadButtonContainer").hide();let n=new Date().getTime();if(!e||!e.url_list||0===e.url_list.length)throw Error("Error: DataSet is undefined or empty");$("#cancelButton").show();var o=setInterval(k,2e3),a=await fetch("/process_url_data",{method:"POST",async:"true",headers:{"Content-Type":"application/json"},body:JSON.stringify({clientUrlSet:e,cancelFlag:y})});let i=await a.json(),l=new Date().getTime(),s=function e(t){let n;if(t<60)n=t+" seconds";else if(t<3600){let o=(t%60).toFixed(2);n=Math.floor(t/60)+" minutes "+o+" seconds"}else n=Math.floor(t/3600)+" hours "+Math.floor(t%3600/60)+" minutes "+seconds+" seconds";return n}(Math.floor((l-n)/1e3));if($("#totalProcessingTime").empty().append("<p>Total Processing Time: "+s+" </p>"),$("#totalProcessingTime").show(),i.error)throw Error("Error from server: "+i.error);if($("#processedTable").show(),i.has_downloadable_data?(T(i.csv_filename),$("#downloadButtonContainer").show()):$("#downloadButtonContainer").hide(),await k(t),!i||!i.pInfo_obj)return}catch(r){console.error("Error sending data to server:",r)}finally{clearInterval(o),$("#loadingIndicator").hide()}}async function T(e){$("#downloadButton").on("click",async function(){try{let t=new FormData;t.append("filename",e);let n=await fetch(`/download/${e}`,{method:"POST",body:t});if(!n.ok)throw Error("Failed to download CSV file");let o=await n.blob(),a=document.createElement("a");a.href=window.URL.createObjectURL(o),a.download=e,a.click(),window.URL.revokeObjectURL(a.href),a.remove()}catch(i){console.error("Error downloading CSV:",i),alert("Error downloading CSV: Please try again.")}})}async function C(e){try{if(void 0!==e){let t=parseInt(e);$("#progressPercentage span").text(t+"%"),$("#progressBlock").css("--value",t)}else{console.error("Progress percentage is undefined");return}}catch(n){console.error("Error updating progress percentage:",n)}}async function _(e){if($("#tryTable").empty(),$("#tableDiv").show(),!e||0===e.length)return;var t='<table id="innerTrytable" class="data-table" border="1">';t+="<thead><tr>";let n=["Sr.No","URL","Domain Status","Expiration Date","For Sale","Response Message","Response Time","Status Code"];n.forEach(e=>{"Sr.No"===e?t+=`<th class="sortable" data-key="${e}">${e} <i class="bi bi-sort-numeric-down"></i></th>`:"Expiration Date"===e?t+=`<th class="sortable" data-key="${e}">${e} <i class="bi bi-sort-numeric-down"></i></th>`:"Response Time"===e?t+=`<th class="sortable" data-key="${e}">${e} <i class="bi bi-sort-numeric-down-alt"></i></th>`:t+=`<th class="sortable" data-key="${e}">${e}</th>`}),t+="</tr></thead><tbody>",e.forEach((e,o)=>{let a="<tr>";n.forEach(t=>{"Expiration Date"===t&&(a+=`<td>${new Date(e[t]).toLocaleString()}</td>`),"Sr.No"===t?a+=`<td>${o+1}</td>`:"Expiration Date"!==t&&(a+=`<td>${e[t]}</td>`)}),a+="</tr>",t+=a}),t+="</tbody></table>",$("#tryTable").append(t),$(".sortable").on("click",function(){let e=$(this).data("key");(function e(t,n){let o=$("#innerTrytable"),a=o.find("tbody > tr").toArray(),i=$(this).hasClass("desc");"Expiration Date"===t||"Response Time"===t?a.sort((e,o)=>{let a=$(e).find(`td:eq(${n.indexOf(t)})`).text(),l=$(o).find(`td:eq(${n.indexOf(t)})`).text();return a=String(a),l=String(l),i?a.localeCompare(l):l.localeCompare(a)}):"Sr.No"===t&&a.sort((e,o)=>{let a=parseInt($(e).find(`td:eq(${n.indexOf(t)})`).text()),l=parseInt($(o).find(`td:eq(${n.indexOf(t)})`).text());return i?l-a:a-l}),o.find("tbody").html(a),$(this).toggleClass("desc")})(e,n)})}let F;function E(e){try{fetch("/input_section",{method:"POST",body:e}).then(e=>{if(!e.ok)throw Error("Failed to fetch sheet names and column names");return e.json()}).then(e=>{F=e.selected_sheet,e.is_csv?(S(e.sheet_columns,F,e.column_data),$("#sheet-name").empty().hide(),$('label[for="sheet-name"]').hide()):(O(F,e.sheet_names),S(e.sheet_columns[F],F,e.column_data),$("#sheet-name").val(F),$("#sheet-name").show(),$('label[for="sheet-name"]').show());var t=$("#column-name").val();if(t){var n=new FormData;n.append("file",$("#file")[0].files[0]),n.append("selected_sheet",F),n.append("selected_column",t),p(n)}}).catch(e=>{console.error("Error fetching sheet names and column names:",e)})}catch(t){console.error("Error fetching sheet names and column names:",t)}}async function O(e,t){var n=$("#sheet-name");n.empty(),t&&t.length>0?($.each(t,function(e,t){n.append($("<option></option>").val(t).text(t))}),e||(e=t[0])):(console.error("No sheet names available."),n.append($("<option disabled selected>Please choose a sheet</option>")))}async function S(e,t){var n=$("#column-name");n.empty(),e?$.each(e,function(e,t){n.append($("<option></option>").val(t).text(t))}):(console.error("No column names available for the selected sheet:",t),n.append($("<option disabled selected>No columns available</option>")));var o=n.val(),a=new FormData;o&&(a.append("file",$("#file")[0].files[0]),a.append("selected_sheet",t),a.append("selected_column",o),p(a))}$(document).on("change","#column-name",function(){var e=$(this).val(),t=new FormData;e?(F=$("#sheet-name").val(),t.append("file",$("#file")[0].files[0]),t.append("selected_sheet",F),t.append("selected_column",e),p(t),$("#totalProcessingTime").empty().hide(),$("#processedTable").hide(),$("#tableDiv").hide(),$("#downloadButtonContainer").hide(),urlFlag=!1):console.log("No valid column selected.")}),$(document).on("change","#sheet-name",function(){F=$(this).val();var e=new FormData;e.append("file",$("#file")[0].files[0]),e.append("selected_sheet",F),E(e),$("totalProcessingTime").empty().hide(),$("#processedTable").hide(),$("#tableDiv").hide(),$("#downloadButtonContainer").hide(),urlFlag=!1}),$(document).on("change","#file",function(){$("#valid_list").empty();var e=$(this)[0].files[0];if(e&&e.size>1048576)return $("#tbl-section").hide(),$("#sheet-name").empty(),$("#column-name").empty(),$("#toggleButton").hide(),alert("File size exceeds 1 MB. Please choose a smaller file."),!1;var t=new FormData;$("#processedTable").hide(),$("#tableDiv").hide(),$("caption").empty().hide(),$("#totalProcessingTime").empty().hide(),$("#downloadButtonContainer").hide(),$("#url-container").hide(),urlFlag=!1,e?(t.append("file",e),E(t)):(console.error("No file selected."),$("#tbl-section").hide(),$("#sheet-name").empty(),$("#column-name").empty())})}),$(".developer").hover(function(){$(".tooltip").css("visibility","visible").css("opacity","1")},function(){$(".tooltip").css("visibility","hidden").css("opacity","0")}),getCookie("cookie_consent")||$("#cookie-consent").show(),$("#accept-cookies").click(function(){getCookie("cookie_consent")||(setCookie("cookie_consent","true",365),$("#cookie-consent").hide(),$.post("/set-cookie"))}),$(document).ready(function(){$(window).scroll(function(){$(".content").each(function(){var e=$(this).offset().top,t=$(window).scrollTop(),n=$(window).height();e<t+n-100&&$(this).addClass("animate2top")}),$(".contentR").each(function(){var e=$(this).offset().top,t=$(window).scrollTop(),n=$(window).height();e<t+n-100&&$(this).addClass("animate2right")}),$(".contentL").each(function(){var e=$(this).offset().top,t=$(window).scrollTop(),n=$(window).height();e<t+n-100&&$(this).addClass("animate2Left")})})});